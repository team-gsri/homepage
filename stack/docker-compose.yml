version: "3.7"

networks:
  reverse:
    external: true

services:
  web:
    image: docker.pkg.github.com/team-gsri/homepage/homepage:dev
    networks:
      - reverse
    deploy:
      labels:
        - "traefik.enable=true"
        - "traefik.http.services.homepage.loadBalancer.server.port=80"
        - "traefik.http.routers.homepage.entrypoints=https"
        - "traefik.http.routers.homepage.middlewares=secure@file,homepage@docker"
        - "traefik.http.routers.homepage.rule=Host(`www-dev.gsri.team`)"
        - "traefik.http.routers.homepage.service=homepage"
        - "traefik.http.routers.homepage.tls.certResolver=gandi"
        - "traefik.http.routers.homepage.tls.options=secure@file"
        - "traefik.http.routers.homepage_unsecure.entrypoints=http"
        - "traefik.http.routers.homepage_unsecure.rule=Host(`www-dev.gsri.team`)"
        - "traefik.http.routers.homepage_unsecure.service=homepage"
        - "traefik.http.middlewares.homepage.headers.sslHost=www-dev.gsri.team"
        
